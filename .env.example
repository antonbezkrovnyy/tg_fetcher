# Environment variables example for Telegram Fetcher Service
# Copy this file to .env and fill in your values

# === REQUIRED: Telegram API Credentials ===
# Get your API credentials from https://my.telegram.org/apps
TELEGRAM_API_ID=12345
TELEGRAM_API_HASH=abcdef1234567890abcdef1234567890
TELEGRAM_PHONE=+1234567890

# === REQUIRED: Sources to Fetch ===
# JSON array format (required by Pydantic Settings for list fields)
# Examples: ["@channel1","@channel2"] or ["https://t.me/channel1"]
TELEGRAM_CHATS=["@ru_python","@pythonstepikchat"]

# === Optional: Fetch Mode ===
# Options: yesterday (default), full, incremental, continuous, date, range
FETCH_MODE=yesterday

# For FETCH_MODE=date
# FETCH_DATE=2025-11-05

# For FETCH_MODE=range
# FETCH_START=2025-11-01
# FETCH_END=2025-11-05

# === Optional: Paths ===
DATA_DIR=./data
SESSION_DIR=./sessions
PROGRESS_FILE=data/progress.json

# === Optional: Multiple Credentials (Future Feature) ===
# Path to directory with multiple credential files
# TELEGRAM_CREDENTIALS_DIR=/secrets/telegram_creds

# === Optional: Rate Limiting ===
RATE_LIMIT_CALLS_PER_SEC=10.0
MAX_PARALLEL_CHANNELS=3
METRICS_MODE=scrape  # scrape|push|both

# === Optional: Retry Settings ===
MAX_RETRY_ATTEMPTS=3
RETRY_BACKOFF_FACTOR=2.0

# === Optional: Progress Reset ===
# Set to true to reset all progress
PROGRESS_RESET=false

# === Optional: Force Refetch ===
# Set to true to force re-fetching even if data already exists (ignores progress)
FORCE_REFETCH=false

# === Optional: Progress & Events ===
# Enable/disable event publishing
ENABLE_EVENTS=true
# Enable/disable progress events (periodic updates)
ENABLE_PROGRESS_EVENTS=true
# Publish progress every N processed messages
PROGRESS_INTERVAL=100

# === Optional: Per-Chat Concurrency ===
FETCH_CONCURRENCY_PER_CHAT=3

# === Optional: Telegram Discussions / Comments ===
# Max number of comments to fetch per channel post (0 to disable)
COMMENTS_LIMIT_PER_MESSAGE=50

# === Optional: Logging ===
LOG_LEVEL=INFO
LOG_FORMAT=json

# === Optional: Storage Backend ===
# fs (default) stores JSON files on disk; mongo uses MongoDB adapter
STORAGE_BACKEND=fs
# Mongo settings (required if STORAGE_BACKEND=mongo)
# MONGO_URL=mongodb://localhost:27017
# MONGO_DB=tg
# MONGO_COLLECTION=messages

# === Optional: Deduplication ===
# Cross-run idempotency via last_processed_id is always on.
# Enable to also skip duplicates within the same run.
DEDUP_IN_RUN_ENABLED=false

# === Optional: Observability ===
ENABLE_METRICS=true
METRICS_PORT=9090
# LOKI_URL=http://loki:3100
# PUSHGATEWAY_URL=http://pushgateway:9091

# === Optional: Events Bus (Redis Pub/Sub) ===
# Redis connection for event publishing (used if ENABLE_EVENTS=true)
REDIS_URL=redis://localhost:6379
# REDIS_PASSWORD=your_password_here
# Pub/Sub channel and service name for events
EVENTS_CHANNEL=tg_events
SERVICE_NAME=tg_fetcher

# === Optional: Preprocessing Feature Flags ===
LINK_NORMALIZE_ENABLED=true
TOKEN_ESTIMATE_ENABLED=true
MERGE_SHORT_MESSAGES_ENABLED=true
MERGE_SHORT_MESSAGES_MAX_LENGTH=120
MERGE_SHORT_MESSAGES_MAX_GAP_SECONDS=90
MESSAGE_CLASSIFIER_ENABLED=true
LANGUAGE_DETECT_ENABLED=true

# === Optional: Commands Subscriber (Redis List) ===
# Name of the Redis list to listen for commands (if command subscriber is used)
COMMANDS_QUEUE=tg_commands
# BLPOP timeout in seconds for command subscriber (0 = block indefinitely)
COMMANDS_BLPOP_TIMEOUT=5

# === Optional: Schema Versions ===
# Data schema version for stored message collections
DATA_SCHEMA_VERSION=1
# Progress schema version for progress tracking file
PROGRESS_SCHEMA_VERSION=1
# Preprocessing version for summary/artifacts
PREPROCESSING_VERSION=1
